---
title: "Cyclistic Bike-Share Case Study"
author: "Vincent Balalian"
output: html_notebook
---
### Our Business Task: to maximize the number of annual memberships...

...(which Cyclistic's finance analysts have concluded are much more profitable than casual riders), by identifying actionable trends among rider data which the marketing team can use to design new, targeted campaigns.<br> 

The director of marketing believes maximizing the number of annual memberships is key to the company's future success. Using the recommendations of this analysis, the marketing team will design new strategies for converting casual riders into annual members. To do that, we must understand 1) how annual members and casual riders differ, 2) why casual riders would buy a membership, and 3) how digital media could affect our marketing tactics. <br>

Final approval of the recommended marketing program goes to the Cyclistic executive team (which is notoriously detail-oriented). In order to provide them with all the information they need to make their decision, the goal of this analysis is to provide all of the relevant insights in a way that's easy to digest without sacrificing attention-to-detail.

### Data Sources
The "Cyclistic" dataset was provided by Google as part of their Coursera Data Analytics course Capstone project, though the data itself has been made available by Motivate International Inc. under this [license](https://www.divvybikes.com/data-license-agreement). 
<br><br>
Despite the fictional nature of the titular company, the data itself reflects the operations of an actual, high-volume bike-share business, which gives us a substantial amount of comprehensive, real-world data to work with. (Any personal or private information has already been removed.)
<br><br>
The data itself can be found [here](https://divvy-tripdata.s3.amazonaws.com/index.html), where csv files are available for each month/period of data, dating back to 2013. For the purposes of this analysis, we'll be using the data from February 2022 to January 2023.
<br>


#### Environment Setup
```{r environment setup, message=FALSE, warning=FALSE}
library(tidyverse)
library(skimr)
library(lubridate)
```
#### Data Import
```{r importing data, message=FALSE, warning=FALSE}
setwd("original data")
df <- list.files() %>% 
  read_csv(id="file_name")
```
#### Data Preview
```{r previewing data}
skim_without_charts(df)
```
A precursory glance tells us: 
<br>1) all 12 months of data were successfully imported into a single dataframe, and 
<br>2) aside from a few variables (start and end stations, and end coordinates), the data is complete.
```{r}
head(df)
```
#### Using this data... 
...we can identify trends among casual riders and annual members by looking at *what* they ride (rideable_type), *when* they ride (started_at, ended_at), and *where* they ride (starting and ending locations). We can also expand on the given "start" and "end" data to determine *how long* they ride, and *how far*.

### Data Processing
The dataset is very long (over 5 million rows), but not too wide. Since the scope of this analysis is relatively simple, processing, analysis, and visualization of the data will be done in **R Studio**, which is uniquely suited to the current business task.
<br>

#### Exploratory Analysis
Let's take a look at the distributions of the two primary categorical values: **rideable_type**, and **member_casual**. 
```{r rideables and rider counts}
riders_and_rideables_count <- count(df, rideable_type, member_casual) %>%
  arrange(desc(n))
rideables_count <- count(df, rideable_type) %>% 
  arrange(desc(n))
riders_count <- count(df, member_casual) %>% 
  arrange(desc(n))
riders_count
rideables_count
riders_and_rideables_count
ggplot(data=df, mapping=aes(x=fct_infreq(rideable_type), fill=member_casual)) + 
  geom_bar(position="dodge") +
  labs(x="rideable_type")
```

So far, the data has no noticeable errors, and is easy to work with. And already, trends are emerging. 
<br><br>
One thing immediately stands out: while annual members are only *somewhat* more likely to ride classic bikes over electric bikes, a noticeable majority of casual riders use *electric bikes* over classic bikes. Also, 100% of the 178251 docked bike rides were made by casual riders.

#### Transforming Data

Since there's not much cleaning needed to work with this dataset, let's continue transforming the original dataframe into different forms that will be useful for later analysis and visualization.
<br><br>
First, let's see if we can get an accurate conversion of distance. 
<br><br>
According to usgs.gov, distance between latitudes is fairly constant, but distance between longitudes varies depending on the latitude. Let's take a look at the latitudes of each ride and see if there's much variation.
```{r latitude check, message=FALSE}
ggplot(data=df, mapping=aes(x=start_lat)) +
  geom_histogram()
```
Since the distribution of latitudes is so visibly narrow, we can assume that our distance conversions will be accurate enough for the purposes of this analysis. Therefore, let's create a new variable, ride_distance, in miles. 
<br><br>
The following chunk creates a new dataframe, df2, which calculates values for ride_time and ride_distance based on the available location data; then removes some clutter among columns.

```{r initial transformation}
df2 <- df %>% 
  mutate(ride_time=seconds_to_period(ended_at-started_at),
         lat_diff=round(abs(start_lat-end_lat)*69, digits=6), 
         lng_diff=round(abs(start_lng-end_lng)*52, digits=6),
         ride_distance=round(abs(lat_diff+lng_diff), digits=6),
         day_of_week=wday(df$started_at, label=TRUE)
         ) %>% 
    select(-file_name, -ride_id, -end_lat, -end_lng, -lat_diff, 
           -lng_diff)
# reorder for a more favorable view
df2 <- df2[,c(1, 10, 11, 12, 13, 2, 3, 5, 7, 4, 6, 8, 9)]
head(df2)
```

